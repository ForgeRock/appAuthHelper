/*

License for AppAuth-JS (Apache 2.0) :
Copyright (c) 2019 The OpenID Foundation

License for AppAuthHelper (Apache 2.0) :
Copyright (c) 2019 ForgeRock, Inc.

*/
"use strict";(function(){function s(d,e,r){function t(u,n){if(!e[u]){if(!d[u]){var i="function"==typeof require&&require;if(!n&&i)return i(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var a=e[u]={exports:{}};d[u][0].call(a.exports,function(e){var r=d[u][1][e];return t(r||e)},a,a.exports,s,d,e,r)}return e[u].exports}for(var o="function"==typeof require&&require,n=0;n<r.length;n++)t(r[n]);return t}return s})()({1:[function(e,t){(function(){"use strict";var r=e("@openid/appauth");t.exports=function(e){return this.appAuthConfig=e,this.client={clientId:this.appAuthConfig.clientId,scopes:this.appAuthConfig.scopes,redirectUri:this.appAuthConfig.redirectUri,authId:this.appAuthConfig.authId,configuration:new r.AuthorizationServiceConfiguration(this.appAuthConfig.endpoints),notifier:new r.AuthorizationNotifier,authorizationHandler:new r.RedirectRequestHandler,tokenHandler:new r.BaseTokenRequestHandler(new r.FetchRequestor())},this.client.authorizationHandler.setAuthorizationNotifier(this.client.notifier),this.client.notifier.setAuthorizationListener(function(e,t,r){t&&(this.client.request=e,this.client.response=t,this.client.code=t.code),r&&(this.client.error=r)}.bind(this)),this},t.exports.prototype={getAvailableData:function(){return new Promise(function(e,t){this.client.authorizationHandler.completeAuthorizationRequestIfPossible().then(function(){var o;if(this.client.code){var n={};this.client.request&&this.client.request.internal&&(n.code_verifier=this.client.request.internal.code_verifier),o=new r.TokenRequest({client_id:this.client.clientId,redirect_uri:this.client.redirectUri,grant_type:r.GRANT_TYPE_AUTHORIZATION_CODE,code:this.client.code,refresh_token:void 0,extras:n}),this.client.tokenHandler.performTokenRequest(this.client.configuration,o).then(function(t){delete this.client.code,delete this.client.request,delete this.client.response,this.fetchTokensFromIndexedDB().then(r=>{var o=localStorage.getItem("currentResourceServer");r||(r={}),t.idToken&&(r.idToken=t.idToken),"refreshToken"===this.appAuthConfig.renewStrategy&&t.refreshToken&&(r.refreshToken=t.refreshToken),null===o?r.accessToken=t.accessToken:(r[o]=t.accessToken,localStorage.removeItem("currentResourceServer")),this.updateTokensInIndexedDB(r).then(()=>e({claims:this.appAuthConfig.oidc?this.getIdTokenClaims(r.idToken):{},idToken:r.idToken,resourceServer:o}))})}.bind(this))}else this.client.error?t(this.client.error.error):this.fetchTokensFromIndexedDB().then(r=>{r?e({idToken:r.idToken,claims:this.appAuthConfig.oidc?this.getIdTokenClaims(r.idToken):{}}):t("tokensUnavailable")})}.bind(this))}.bind(this))},authzRequest:function(e,t,o){o=o||{};var n=new r.AuthorizationRequest({client_id:t.clientId,redirect_uri:t.redirectUri,scope:t.scopes,response_type:r.AuthorizationRequest.RESPONSE_TYPE_CODE,extras:Object.keys(o).concat(Object.keys(t.extras||{})).reduce(function(e,r){return e[r]=o[r]||t.extras[r],e},{})});e.authorizationHandler.performAuthorizationRequest(e.configuration,n)},silentAuthzRequest:function(e){let t=Object.create(this.appAuthConfig),o=()=>this.checkForActiveAuthzRequest().then(function(e){return e||this.authzRequest(this.client,t,{prompt:"none"}),"authCode"}.bind(this));return e&&(localStorage.setItem("currentResourceServer",e),t.scopes=this.appAuthConfig.resourceServers[e]),"authCode"!==t.renewStrategy&&e?this.fetchTokensFromIndexedDB().then(n=>n.refreshToken?this.client.tokenHandler.performTokenRequest(this.client.configuration,new r.TokenRequest({client_id:this.client.clientId,redirect_uri:this.client.redirectUri,grant_type:r.GRANT_TYPE_REFRESH_TOKEN,refresh_token:n.refreshToken,extras:{scope:t.scopes}})).then(t=>t.refreshToken&&t.accessToken?(n.refreshToken=t.refreshToken,n[e]=t.accessToken,this.updateTokensInIndexedDB(n).then(()=>"refreshToken")):o.call(this),()=>o.call(this)):o.call(this)):o.call(this)},getAuthzURL:function(){return new Promise(e=>{this.client.authorizationHandler=new r.RedirectRequestHandler(void 0,void 0,{assign:e}),this.authzRequest(this.client,this.appAuthConfig)})},clearActiveAuthzRequests:function(){return this.checkForActiveAuthzRequest().then(function(e){if(e)return Promise.all([this.client.authorizationHandler.storageBackend.removeItem("appauth_current_authorization_request"),this.client.authorizationHandler.storageBackend.removeItem(e+"_appauth_authorization_request"),this.client.authorizationHandler.storageBackend.removeItem(e+"_appauth_authorization_service_configuration")])}.bind(this))},checkForActiveAuthzRequest:function(){return this.client.authorizationHandler.storageBackend.getItem("appauth_current_authorization_request")},fetchTokensFromIndexedDB:function(){return new Promise((e,t)=>{var r=indexedDB.open("appAuth"),o=function(){return r.result.createObjectStore(this.appAuthConfig.authId)}.bind(this),n=()=>{if(!r.result.objectStoreNames.contains(this.appAuthConfig.authId)){var i=r.result.version;return i++,r.result.close(),r=indexedDB.open("appAuth",i),r.onupgradeneeded=o,void(r.onsuccess=n)}var s=r.result.transaction([this.appAuthConfig.authId],"readonly").objectStore(this.appAuthConfig.authId).get("tokens");s.onsuccess=()=>{var t=s.result;r.result.close(),e(t)},s.onerror=t};r.onupgradeneeded=o,r.onsuccess=n,r.onerror=t})},updateTokensInIndexedDB:function(e){return new Promise((t,r)=>{var o=indexedDB.open("appAuth"),n=function(){return o.result.createObjectStore(this.appAuthConfig.authId)}.bind(this);o.onupgradeneeded=n,o.onsuccess=()=>{var n=o.result.transaction([this.client.authId],"readwrite").objectStore(this.client.authId).put(e,"tokens");n.onsuccess=()=>{o.result.close(),t()},n.onerror=r},o.onerror=r})},getIdTokenClaims:function(e){return JSON.parse(atob(e.split(".")[1].replace("-","+").replace("_","/")))},getResourceServerFromUrl:function(e){return"object"==typeof this.appAuthConfig.resourceServers&&Object.keys(this.appAuthConfig.resourceServers).length?Object.keys(this.appAuthConfig.resourceServers).filter(t=>0===e.indexOf(t))[0]:void 0},makeRSRequest:function(e){return Promise.all([this.getResourceServerFromUrl(e.url),this.fetchTokensFromIndexedDB()]).then(t=>{var r=t[0],o=t[1];return o[r]?(e.options.headers.Authorization=`Bearer ${o[r]}`,e):Promise.reject("invalid_token")}).then(e=>fetch(e.url,e.options)).then(e=>"invalid_token"===this.getAuthHeaderDetails(e).error?Promise.reject("invalid_token"):e).then(e=>this.serializeResponse(e))},getAuthHeaderDetails:function(e){var t=e.headers.get("www-authenticate");return!e.ok&&t&&t.match(/^Bearer\b/)?t.replace(/^Bearer\b/,"").match(/[^,=]+=".*?"/g).reduce(function(e,t){var r=t.split("=");return e[r[0].replace(/\s/g,"")]=r[1].replace(/"(.*)"/,"$1"),e},{}):{}},serializeResponse:function(e){return e.text().then(t=>({body:t,init:{status:e.status,statusText:e.statusText,headers:this.serializeHeaders(e.headers)}}))},serializeHeaders:function(e){if(!e)return;let t={},r=e.keys(),o=null;for(;(o=r.next())&&!o.done;)t[o.value.toLowerCase()]=e.get(o.value);return t},logout:function(e){return this.fetchTokensFromIndexedDB().then(function(t){if(t){var o=[];return e.revoke_tokens&&t.accessToken&&o.push(new r.RevokeTokenRequest({client_id:this.appAuthConfig.clientId,token_type_hint:"access_token",token:t.accessToken})),e.revoke_tokens&&t.refreshToken&&o.push(new r.RevokeTokenRequest({client_id:this.appAuthConfig.clientId,token_type_hint:"refresh_token",token:t.refreshToken})),Promise.all(o.concat(Object.keys(this.appAuthConfig.resourceServers).filter(function(r){return e.revoke_tokens&&!!t[r]}).map(function(e){return new r.RevokeTokenRequest({client_id:this.appAuthConfig.clientId,token_type_hint:"access_token",token:t[e]})}.bind(this))).map(function(e){return this.client.tokenHandler.performRevokeTokenRequest(this.client.configuration,e)}.bind(this))).then(function(){return e.end_session&&this.appAuthConfig.oidc&&t.idToken&&this.client.configuration.endSessionEndpoint?fetch(this.client.configuration.endSessionEndpoint+"?id_token_hint="+t.idToken):void 0}.bind(this)).then(function(){return new Promise(function(e,t){var r=indexedDB.open("appAuth");r.onsuccess=function(){var t=r.result.transaction([this.appAuthConfig.authId],"readwrite").objectStore(this.appAuthConfig.authId).clear();r.result.close(),t.onsuccess=e}.bind(this),r.onerror=t}.bind(this))}.bind(this))}}.bind(this))}}})()},{"@openid/appauth":10}],2:[function(e){(function(){"use strict";window.location.hash=window.location.search.substring(1);var t;if(window.location.search){const e=new URLSearchParams(window.location.search),r=e.get("iss"),o=e.get("error"),n=e=>{for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);if(r.includes("appAuthConfig-")){const t=JSON.parse(localStorage.getItem(r)),o=t&&e===t.appHostname;if(o)return t}}};if(r){const e=new URL(r).host;t=n(e)}else o&&"interaction_required"===o&&(t=n(window.location.host))}var r,o=e("./TokenManager");t&&window.location.hash.replace("#","").length&&(r=new o(t),r.getAvailableData().then(e=>{window.location.hash="",parent.postMessage({message:"appAuth-tokensAvailable",resourceServer:e.resourceServer,idTokenClaims:e.claims,idToken:e.idToken,authId:t.authId},TRUSTED_ORIGIN)},e=>{r.getAuthzURL().then(r=>parent.postMessage({message:"appAuth-interactionRequired",error:e,authorizationUrl:r,authId:t.authId},TRUSTED_ORIGIN))}).finally(()=>{parent.document.getElementById(`AppAuthIframe-${t.authId}`)||setTimeout(()=>{var e=document.createElement("a");e.href=t.appLocation||".",e.hash+="&loggedin=true",window.location.assign(e.href)},0)})),window.addEventListener("message",function(t){if(t.origin===TRUSTED_ORIGIN){var e=t.data.config.authId;switch(r=r||new o(t.data.config),t.data.message){case"appAuth-config":localStorage.setItem(`appAuthConfig-${e}`,JSON.stringify(t.data.config)),r.clearActiveAuthzRequests().then(()=>t.ports[0].postMessage("configured"));break;case"appAuth-logout":r.logout(t.data.options).then(()=>{localStorage.removeItem(`appAuthConfig-${e}`),parent.postMessage({message:"appAuth-logoutComplete",authId:e},TRUSTED_ORIGIN)});break;case"appAuth-getFreshAccessToken":r.silentAuthzRequest(t.data.resourceServer).then(r=>{"refreshToken"===r&&parent.postMessage({message:"appAuth-tokensAvailable",resourceServer:t.data.resourceServer,authId:e},TRUSTED_ORIGIN)});break;case"appAuth-getAvailableData":r.getAvailableData().then(t=>{parent.postMessage({message:"appAuth-tokensAvailable",idTokenClaims:t.claims,idToken:t.idToken,authId:e},TRUSTED_ORIGIN)},()=>{r.silentAuthzRequest()});break;case"makeRSRequest":r.makeRSRequest(t.data.request).then(e=>t.ports[0].postMessage({response:e}),e=>t.ports[0].postMessage({error:e}));}}})})()},{"./TokenManager":1}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./crypto_utils"),n=e("./logger"),i=function(e){return e.generateRandom(10)},s=function(){function e(t,r,n){void 0===r&&(r=new o.DefaultCrypto),void 0===n&&(n=!0),this.crypto=r,this.usePkce=n,this.clientId=t.client_id,this.redirectUri=t.redirect_uri,this.scope=t.scope,this.responseType=t.response_type||e.RESPONSE_TYPE_CODE,this.state=t.state||i(r),this.extras=t.extras,this.internal=t.internal}return e.prototype.setupCodeVerifier=function(){var e=this;if(!this.usePkce)return Promise.resolve();var t=this.crypto.generateRandom(128),r=this.crypto.deriveChallenge(t).catch(function(e){n.log("Unable to generate PKCE challenge. Not using PKCE",e)});return r.then(function(r){r&&(e.internal=e.internal||{},e.internal.code_verifier=t,e.extras=e.extras||{},e.extras.code_challenge=r,e.extras.code_challenge_method="S256")})},e.prototype.toJson=function(){var e=this;return this.setupCodeVerifier().then(function(){return{response_type:e.responseType,client_id:e.clientId,redirect_uri:e.redirectUri,scope:e.scope,state:e.state,extras:e.extras,internal:e.internal}})},e.RESPONSE_TYPE_TOKEN="token",e.RESPONSE_TYPE_CODE="code",e}();r.AuthorizationRequest=s},{"./crypto_utils":7,"./logger":11}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./logger"),n=function(){function e(){this.listener=null}return e.prototype.setAuthorizationListener=function(e){this.listener=e},e.prototype.onAuthorizationComplete=function(e,t,r){this.listener&&this.listener(e,t,r)},e}();r.AuthorizationNotifier=n,r.BUILT_IN_PARAMETERS=["redirect_uri","client_id","response_type","state","scope"];var i=function(){function e(e,t){this.utils=e,this.crypto=t,this.notifier=null}return e.prototype.buildRequestUrl=function(e,t){var o={redirect_uri:t.redirectUri,client_id:t.clientId,response_type:t.responseType,state:t.state,scope:t.scope};if(t.extras)for(var n in t.extras)t.extras.hasOwnProperty(n)&&0>r.BUILT_IN_PARAMETERS.indexOf(n)&&(o[n]=t.extras[n]);var i=this.utils.stringify(o),s=e.authorizationEndpoint;return s+"?"+i},e.prototype.completeAuthorizationRequestIfPossible=function(){var e=this;return o.log("Checking to see if there is an authorization response to be delivered."),this.notifier||o.log("Notifier is not present on AuthorizationRequest handler.\n          No delivery of result will be possible"),this.completeAuthorizationRequest().then(function(t){t||o.log("No result is available yet."),t&&e.notifier&&e.notifier.onAuthorizationComplete(t.request,t.response,t.error)})},e.prototype.setAuthorizationNotifier=function(e){return this.notifier=e,this},e}();r.AuthorizationRequestHandler=i},{"./logger":11}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e){this.code=e.code,this.state=e.state}return e.prototype.toJson=function(){return{code:this.code,state:this.state}},e}();r.AuthorizationResponse=o;var n=function(){function e(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri,this.state=e.state}return e.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri,state:this.state}},e}();r.AuthorizationError=n},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./xhr"),n=function(){function e(e){this.authorizationEndpoint=e.authorization_endpoint,this.tokenEndpoint=e.token_endpoint,this.revocationEndpoint=e.revocation_endpoint,this.userInfoEndpoint=e.userinfo_endpoint,this.endSessionEndpoint=e.end_session_endpoint}return e.prototype.toJson=function(){return{authorization_endpoint:this.authorizationEndpoint,token_endpoint:this.tokenEndpoint,revocation_endpoint:this.revocationEndpoint,end_session_endpoint:this.endSessionEndpoint,userinfo_endpoint:this.userInfoEndpoint}},e.fetchFromIssuer=function(t,r){var n=r||new o.JQueryRequestor;return n.xhr({url:t+"/"+".well-known"+"/"+"openid-configuration",dataType:"json",method:"GET"}).then(function(t){return new e(t)})},e}();r.AuthorizationServiceConfiguration=n},{"./xhr":19}],7:[function(e,t,r){"use strict";function o(e){for(var t,r=[],o=0;o<e.byteLength;o+=1)t=e[o]%62,r.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[t]);return r.join("")}function n(e){var t=s.fromByteArray(new Uint8Array(e));return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function i(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return r}Object.defineProperty(r,"__esModule",{value:!0});var s=e("base64-js"),a=e("./errors"),p="undefined"!=typeof window&&!!window.crypto,u=p&&!!window.crypto.subtle;r.bufferToString=o,r.urlSafe=n,r.textEncodeLite=i;var d=function(){function e(){}return e.prototype.generateRandom=function(e){var t=new Uint8Array(e);if(p)window.crypto.getRandomValues(t);else for(var r=0;r<e;r+=1)t[r]=0|Math.random()*"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".length;return o(t)},e.prototype.deriveChallenge=function(e){return 43>e.length||128<e.length?Promise.reject(new a.AppAuthError("Invalid code length.")):u?new Promise(function(t,r){crypto.subtle.digest("SHA-256",i(e)).then(function(e){return t(n(new Uint8Array(e)))},function(e){return r(e)})}):Promise.reject(new a.AppAuthError("window.crypto.subtle is unavailable."))},e}();r.DefaultCrypto=d},{"./errors":8,"base64-js":20}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){return function(e,t){this.message=e,this.extras=t}}();r.AppAuthError=o},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IS_LOG=!0,r.IS_PROFILE=!1},{}],10:[function(e,t,r){"use strict";function o(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),o(e("./authorization_request")),o(e("./authorization_request_handler")),o(e("./authorization_response")),o(e("./authorization_service_configuration")),o(e("./crypto_utils")),o(e("./errors")),o(e("./flags")),o(e("./logger")),o(e("./query_string_utils")),o(e("./redirect_based_handler")),o(e("./revoke_token_request")),o(e("./storage")),o(e("./token_request")),o(e("./token_request_handler")),o(e("./token_response")),o(e("./xhr"))},{"./authorization_request":3,"./authorization_request_handler":4,"./authorization_response":5,"./authorization_service_configuration":6,"./crypto_utils":7,"./errors":8,"./flags":9,"./logger":11,"./query_string_utils":12,"./redirect_based_handler":13,"./revoke_token_request":14,"./storage":15,"./token_request":16,"./token_request_handler":17,"./token_response":18,"./xhr":19}],11:[function(e,t,r){"use strict";function o(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(s.IS_LOG){var o=t?t.length:0;0<o?console.log.apply(console,i([e],t)):console.log(e)}}function n(e,t,r){var n=r.value,s=n.name;return s||(s="anonymous function"),r.value=a?function(e){console.profile(s);var t=window.performance.now(),r=n.call.apply(n,i([this||window],e)),o=window.performance.now()-t;return console.log(s+" took "+o+" ms"),console.profileEnd(),r}:function(e){o("Profile start "+s);var t=Date.now(),r=n.call.apply(n,i([this||window],e)),a=Date.now()-t;return o("Profile end "+s+" took "+a+" ms."),r},r}var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<o;t++)for(var p=arguments[t],a=0,u=p.length;a<u;a++,r++)n[r]=p[a];return n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./flags");r.log=o;var a="undefined"!=typeof window&&!!window.performance&&!!console.profile;r.profile=function(e,t,r){return s.IS_PROFILE?n(e,t,r):r}},{"./flags":9}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(){}return e.prototype.parse=function(e,t){return t?this.parseQueryString(e.hash):this.parseQueryString(e.search)},e.prototype.parseQueryString=function(e){var t={};e=e.trim().replace(/^(\?|#|&)/,"");for(var r=e.split("&"),o=0;o<r.length;o+=1){var n=r[o],s=n.split("=");if(2<=s.length){var a=decodeURIComponent(s.shift()),p=0<s.length?s.join("="):null;p&&(t[a]=decodeURIComponent(p))}}return t},e.prototype.stringify=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&e[r]&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},e}();r.BasicQueryStringUtils=o},{}],13:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("./authorization_request"),i=e("./authorization_request_handler"),s=e("./authorization_response"),a=e("./crypto_utils"),p=e("./logger"),u=e("./query_string_utils"),d=e("./storage"),c=function(e){return e+"_appauth_authorization_request"},l=function(e){return e+"_appauth_authorization_service_configuration"},h="appauth_current_authorization_request",_=function(e){function t(t,r,o,n){void 0===t&&(t=new d.LocalStorageBackend),void 0===r&&(r=new u.BasicQueryStringUtils),void 0===o&&(o=window.location),void 0===n&&(n=new a.DefaultCrypto);var i=e.call(this,r,n)||this;return i.storageBackend=t,i.locationLike=o,i}return o(t,e),t.prototype.performAuthorizationRequest=function(e,t){var r=this,o=this.crypto.generateRandom(10),n=Promise.all([this.storageBackend.setItem(h,o),t.toJson().then(function(e){return r.storageBackend.setItem(c(o),JSON.stringify(e))}),this.storageBackend.setItem(l(o),JSON.stringify(e.toJson()))]);n.then(function(){var o=r.buildRequestUrl(e,t);p.log("Making a request to ",t,o),r.locationLike.assign(o)})},t.prototype.completeAuthorizationRequest=function(){var e=this;return this.storageBackend.getItem(h).then(function(t){return t?e.storageBackend.getItem(c(t)).then(function(e){return JSON.parse(e)}).then(function(e){return new n.AuthorizationRequest(e)}).then(function(r){var o=""+e.locationLike.origin+e.locationLike.pathname,n=e.utils.parse(e.locationLike,!0),i=n.state,a=n.code,u=n.error;p.log("Potential authorization request ",o,n,i,a,u);var d=i===r.state,_=null,g=null;if(d){if(u){var f=n.error_uri,k=n.error_description;g=new s.AuthorizationError({error:u,error_description:k,error_uri:f,state:i})}else _=new s.AuthorizationResponse({code:a,state:i});return Promise.all([e.storageBackend.removeItem(h),e.storageBackend.removeItem(c(t)),e.storageBackend.removeItem(l(t))]).then(function(){return p.log("Delivering authorization response"),{request:r,response:_,error:g}})}return p.log("Mismatched request (state and request_uri) dont match."),Promise.resolve(null)}):null})},t}(i.AuthorizationRequestHandler);r.RedirectRequestHandler=_},{"./authorization_request":3,"./authorization_request_handler":4,"./authorization_response":5,"./crypto_utils":7,"./logger":11,"./query_string_utils":12,"./storage":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e){this.token=e.token,this.tokenTypeHint=e.token_type_hint,this.clientId=e.client_id,this.clientSecret=e.client_secret}return e.prototype.toJson=function(){var e={token:this.token};return this.tokenTypeHint&&(e.token_type_hint=this.tokenTypeHint),this.clientId&&(e.client_id=this.clientId),this.clientSecret&&(e.client_secret=this.clientSecret),e},e.prototype.toStringMap=function(){var e=this.toJson();return e},e}();r.RevokeTokenRequest=o},{}],15:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=function(){return function(){}}();r.StorageBackend=n;var i=function(e){function t(t){var r=e.call(this)||this;return r.storage=t||window.localStorage,r}return o(t,e),t.prototype.getItem=function(e){var t=this;return new Promise(function(r){var o=t.storage.getItem(e);o?r(o):r(null)})},t.prototype.removeItem=function(e){var t=this;return new Promise(function(r){t.storage.removeItem(e),r()})},t.prototype.clear=function(){var e=this;return new Promise(function(t){e.storage.clear(),t()})},t.prototype.setItem=function(e,t){var r=this;return new Promise(function(o){r.storage.setItem(e,t),o()})},t}(n);r.LocalStorageBackend=i},{}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.GRANT_TYPE_AUTHORIZATION_CODE="authorization_code",r.GRANT_TYPE_REFRESH_TOKEN="refresh_token";var o=function(){function e(e){this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.grantType=e.grant_type,this.code=e.code,this.refreshToken=e.refresh_token,this.extras=e.extras}return e.prototype.toJson=function(){return{grant_type:this.grantType,code:this.code,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,client_id:this.clientId,extras:this.extras}},e.prototype.toStringMap=function(){var e={grant_type:this.grantType,client_id:this.clientId,redirect_uri:this.redirectUri};if(this.code&&(e.code=this.code),this.refreshToken&&(e.refresh_token=this.refreshToken),this.extras)for(var t in this.extras)this.extras.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=this.extras[t]);return e},e}();r.TokenRequest=o},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=e("./errors"),n=e("./query_string_utils"),i=e("./token_response"),s=e("./xhr"),a=function(){function e(e,t){void 0===e&&(e=new s.JQueryRequestor),void 0===t&&(t=new n.BasicQueryStringUtils),this.requestor=e,this.utils=t}return e.prototype.isTokenResponse=function(e){return void 0===e.error},e.prototype.performRevokeTokenRequest=function(e,t){var r=this.requestor.xhr({url:e.revocationEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(t.toStringMap())});return r.then(function(){return!0})},e.prototype.performTokenRequest=function(e,t){var r=this,n=this.requestor.xhr({url:e.tokenEndpoint,method:"POST",dataType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(t.toStringMap())});return n.then(function(e){return r.isTokenResponse(e)?new i.TokenResponse(e):Promise.reject(new o.AppAuthError(e.error,new i.TokenError(e)))})},e}();r.BaseTokenRequestHandler=a},{"./errors":8,"./query_string_utils":12,"./token_response":18,"./xhr":19}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.nowInSeconds=function(){return Math.round(new Date().getTime()/1e3)};var o=function(){function e(e){this.accessToken=e.access_token,this.tokenType=e.token_type||"bearer",this.expiresIn=e.expires_in,this.refreshToken=e.refresh_token,this.scope=e.scope,this.idToken=e.id_token,this.issuedAt=e.issued_at||r.nowInSeconds()}return e.prototype.toJson=function(){return{access_token:this.accessToken,id_token:this.idToken,refresh_token:this.refreshToken,scope:this.scope,token_type:this.tokenType,issued_at:this.issuedAt,expires_in:this.expiresIn}},e.prototype.isValid=function(e){if(void 0===e&&(e=-600),this.expiresIn){var t=r.nowInSeconds();return t<this.issuedAt+this.expiresIn+e}return!0},e}();r.TokenResponse=o;var n=function(){function e(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri}return e.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri}},e}();r.TokenError=n},{}],19:[function(e,t,r){"use strict";var o=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("./errors"),i=function(){return function(){}}();r.Requestor=i;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.xhr=function(e){var t=$.ajax(e);return new Promise(function(e,r){t.then(function(t){e(t)},function(e,t,o){r(new n.AppAuthError(o))})})},t}(i);r.JQueryRequestor=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.xhr=function(e){if(!e.url)return Promise.reject(new n.AppAuthError("A URL must be provided."));var t=new URL(e.url),r={};if(r.method=e.method,r.mode="cors",e.data)if(e.method&&"POST"===e.method.toUpperCase())r.body=e.data;else{var o=new URLSearchParams(e.data);o.forEach(function(e,r){t.searchParams.append(r,e)})}if(r.headers={},e.headers)for(var s in e.headers)e.headers.hasOwnProperty(s)&&(r.headers[s]=e.headers[s]);var i=e.dataType&&"json"===e.dataType.toLowerCase();return i&&(r.headers.Accept="application/json, text/javascript, */*; q=0.01"),fetch(t.toString(),r).then(function(e){if(200<=e.status&&300>e.status){var t=e.headers.get("content-type");return i||t&&-1!==t.indexOf("application/json")?e.json():e.text()}return Promise.reject(new n.AppAuthError(e.status.toString(),e.statusText))})},t}(i);r.FetchRequestor=a;var p=function(e){function t(t){var r=e.call(this)||this;return r.promise=t,r}return o(t,e),t.prototype.xhr=function(){return this.promise},t}(i);r.TestRequestor=p},{"./errors":8}],20:[function(e,t,r){'use strict';function o(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var o=r===t?0:4-r%4;return[r,o]}function n(e,t,r){return 3*(t+r)/4-r}function s(e){var t,r,s=o(e),a=s[0],p=s[1],u=new l(n(e,a,p)),d=0,h=0<p?a-4:a;for(r=0;r<h;r+=4)t=c[e.charCodeAt(r)]<<18|c[e.charCodeAt(r+1)]<<12|c[e.charCodeAt(r+2)]<<6|c[e.charCodeAt(r+3)],u[d++]=255&t>>16,u[d++]=255&t>>8,u[d++]=255&t;return 2===p&&(t=c[e.charCodeAt(r)]<<2|c[e.charCodeAt(r+1)]>>4,u[d++]=255&t),1===p&&(t=c[e.charCodeAt(r)]<<10|c[e.charCodeAt(r+1)]<<4|c[e.charCodeAt(r+2)]>>2,u[d++]=255&t>>8,u[d++]=255&t),u}function a(e){return d[63&e>>18]+d[63&e>>12]+d[63&e>>6]+d[63&e]}function p(e,t,r){for(var o,n=[],s=t;s<r;s+=3)o=(16711680&e[s]<<16)+(65280&e[s+1]<<8)+(255&e[s+2]),n.push(a(o));return n.join("")}function u(e){for(var t,r=e.length,o=r%3,n=[],s=16383,a=0,u=r-o;a<u;a+=s)n.push(p(e,a,a+s>u?u:a+s));return 1===o?(t=e[r-1],n.push(d[t>>2]+d[63&t<<4]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],n.push(d[t>>10]+d[63&t>>4]+d[63&t<<2]+"=")),n.join("")}r.byteLength=function(e){var t=o(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=s,r.fromByteArray=u;for(var d=[],c=[],l="undefined"==typeof Uint8Array?Array:Uint8Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=0,g=h.length;_<g;++_)d[_]=h[_],c[h.charCodeAt(_)]=_;c[45]=62,c[95]=63},{}]},{},[2]);
